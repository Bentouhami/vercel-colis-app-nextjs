@startuml MCD_ColisApp_Conceptuel_Abstrait_CORRIGE
!theme vibrant
title MCD ColisApp - Modèle Conceptuel (corrigé selon Prisma)
allowmixing
skinparam entity {
  BackgroundColor White
  BorderColor Black
}
skinparam usecase {
  BorderColor Black
  BackgroundColor LightYellow
  FontSize 12
}

' --- ENTITÉS ---
entity Utilisateur {
  prénom
  nom
  email
  téléphone
  rôle
  dateNaissance
  estEntreprise
}

entity Adresse {
  rue
  complément
  numéroRue
  numéroBoîte
}

entity Ville {
  nom
  latitude
  longitude
}

entity Pays {
  nom
  codeISO2
  codeISO3
  indicatifTéléphonique
  capitale
  devise
  emoji
}

entity FuseauHoraire {
  nomZone
  décalageGMT
  abréviation
}

entity TauxTVA {
  pourcentageTVA
  typeTVA
}

entity Agence {
  nom
  localisation
  téléphone
  email
  numéroTVA
  capacité
  placesDisponibles
}

entity JournalActivite {
  typeActivite
  détails
  rôlePersonnel
}

entity Envoi {
  numéroSuivi
  urlQRCode
  statutSimulation
  statutEnvoi
  poidsTotal
  volumeTotal
  prixTotal
  payé
  dateDépart
  dateArrivée
  commentaire
}

entity Colis {
  hauteur
  poids
  largeur
  longueur
}

entity Paiement {
  méthode
  statut
  montant
  idTransaction
}

entity ÉvénementSuivi {
  statutÉvénement
  localisation
  description
}

entity Transport {
  numéro
  volumeBase
  poidsBase
  volumeActuel
  poidsActuel
  estDisponible
}

entity PlanningTransport {
  dateDépart
  dateArrivée
  estFérié
}

entity RendezVous {
  date
  statut
}

entity Tarif {
  tauxPoids
  tauxVolume
  tauxBase
  tauxFixe
}

entity Coupon {
  codeCoupon
  montantRéduction
  pourcentageRéduction
  nombreUtilisations
  dateDébut
  dateExpiration
}

entity Notification {
  message
  estLu
}

' --- ASSOCIATIONS (ovales) ---
usecase "(Habite à)" as HabiteA
HabiteA : typeAdresse

usecase "(Est\nlocalisée à)" as EstLocaliseeA
usecase "(Fait\npartie de)" as FaitPartieDe
usecase "(A pour\nfuseau)" as AFuseau
usecase "(Applique\nTVA)" as AppliqueTVA

usecase "(Crée)" as Cree
usecase "(Est\nclient de)" as EstClientDe
usecase "(Est membre du\npersonnel)" as EstMembrePersonnel
EstMembrePersonnel : rôlePersonnel
usecase "(Effectue\nactivité)" as EffectueActivite

usecase "(Envoie)" as Envoie
usecase "(Reçoit)" as Recoit

usecase "(Part de)" as PartDe
usecase "(Arrive à)" as ArriveA

usecase "(Utilise\ntransport)" as UtiliseTransport
usecase "(Contient)" as Contient
usecase "(Règle)" as Regle
usecase "(A pour\nhistorique)" as Historique
usecase "(A rendez-vous)" as ARendezVous

usecase "(Bénéficie\ncoupon)" as BeneficieCoupon
usecase "(Utilise\ncoupon)" as UtiliseCoupon

usecase "(Reçoit\nnotification)" as RecoitNotification
usecase "(Concerne\nenvoi)" as ConcerneEnvoi
usecase "(Concerne\nagence)" as ConcerneAgence

usecase "(Est\nsituée à)" as EstSitueeA
usecase "(Applique\ntarif)" as AppliqueTarif
usecase "(Gère\ntransport)" as GereTransport
usecase "(A pour\nplanning)" as APourPlanning

usecase "(Est client/destinataire\nde)" as EstClientDestinataireDe

' --- RELATIONS ---

' User ↔ Address (M:N via UserAddress)
Utilisateur "0,n" -- HabiteA
HabiteA -- "0,n" Adresse

' Adresse ↔ Ville (1 adresse → 1 ville ; 1 ville → 0..n adresses)
Adresse "1,1" -- EstLocaliseeA
EstLocaliseeA -- "0,n" Ville

' Ville ↔ Pays (City.countryId NOT NULL)
Ville "1,1" -- FaitPartieDe
FaitPartieDe -- "0,n" Pays

' Pays ↔ FuseauHoraire (Country 0..n Timezone ; Timezone 1 Country)
Pays "0,n" -- AFuseau
AFuseau -- "1,1" FuseauHoraire

' Pays ↔ TauxTVA (Country 0..1 VatRate ; VatRate 1 Country)
Pays "0,1" -- AppliqueTVA
AppliqueTVA -- "1,1" TauxTVA

' Agence ↔ Adresse (Agency 1 Address ; Address 0..1 Agency)
Agence "1,1" -- EstSitueeA
EstSitueeA -- "0,1" Adresse

' Utilisateur ↔ Agence (creator) (User 0..n Agencies ; Agency 0..1 creator)
Utilisateur "0,n" -- Cree
Cree -- "0,1" Agence

' Utilisateur ↔ Agence (clients) (M:N)
Utilisateur "0,n" -- EstClientDe
EstClientDe -- "0,n" Agence

' Utilisateur ↔ Agence (staff) (M:N avec rôle)
Utilisateur "0,n" -- EstMembrePersonnel
EstMembrePersonnel -- "0,n" Agence

' Client–Destinataire (M:N)
Utilisateur "0,n" -u- EstClientDestinataireDe
EstClientDestinataireDe -- "0,n" Utilisateur

' Journal d'activité (user/agency optionnels)
Utilisateur "0,n" -- EffectueActivite
EffectueActivite -l- "0,1" JournalActivite
Agence "0,n" --u- EffectueActivite

' Envoi – client (userId?)
Utilisateur "0,n" -- Envoie
Envoie -- "0,1" Envoi

' Envoi – destinataire (destinataireId?)
Utilisateur "0,n" - Recoit
Recoit - "0,1" Envoi

' Envoi – agences (départ/arrivée requis)
Agence "0,n" -- PartDe
PartDe -- "1,1" Envoi
Agence "0,n" -- ArriveA
ArriveA -- "1,1" Envoi

' Envoi – Transport (transportId?)
Envoi "0,1" --- UtiliseTransport
UtiliseTransport --- "0,n" Transport

' Envoi – Colis (Envoi 0..n ; Colis 1)
Envoi "0,n" -- Contient
Contient -- "1,1" Colis

' Envoi – Paiement (Envoi 0..1 ; Paiement 1)
Envoi "0,1" -- Regle
Regle -- "1,1" Paiement

' Envoi – ÉvénementSuivi (Envoi 0..n ; Événement 1)
Envoi "0,n" -- Historique
Historique -- "1,1" ÉvénementSuivi

' Rendez-vous (Envoi 0..1 ; RendezVous 1 ; Agence 0..n)
Envoi "0,1" -- ARendezVous
ARendezVous -- "1,1" RendezVous
Agence "0,n" -d- ARendezVous

' Coupons (M:N)
Utilisateur "0,n" -- BeneficieCoupon
BeneficieCoupon -- "0,n" Coupon
Envoi "0,n" --r-- UtiliseCoupon
UtiliseCoupon --u-- "0,n" Coupon

' Notifications (agency 1, envoi 1, utilisateur 0..1)
Utilisateur "0,n" -l- RecoitNotification
RecoitNotification -- "0,1" Notification
Envoi "0,n" -- ConcerneEnvoi
ConcerneEnvoi -- "1,1" Notification
Agence "0,n" -- ConcerneAgence
ConcerneAgence -u- "1,1" Notification

' Agence – Tarif (Tarif global possible : agency 0..n ; tarif 0..1)
Agence "0,n" -- AppliqueTarif
AppliqueTarif -- "0,1" Tarif

' Agence – Transport (agency 0..n ; transport 0..1)
Agence "0,n" -- GereTransport
GereTransport -- "0,1" Transport

' Transport – Planning (transport 1 ; planning 0..n)
Transport "1,1" -- APourPlanning
APourPlanning -- "0,n" PlanningTransport

@enduml
